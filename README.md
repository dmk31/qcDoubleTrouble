# Скрипт для поиска дубликатов задач в Yandex Tracker

Этот скрипт предназначен для проверки создаваемой задачи на наличие дубликатов в Yandex Tracker. Он использует TF-IDF и косинусное сходство для поиска похожих задач по заголовкам и описаниям.

## Логика работы

1.  **Получение данных**: 
Скрипт подключается к Yandex Tracker API и загружает задачи по заданному фильтру: `Queue: PLATFORM, PLATFORMCOMP, PLATFORMUI, PLATFORMBPMN, PLATFORMNSI Status: inProgress, open, readyForTest, tested, testing, vozvrasena, needInfo `.
2.  **Кэширование**: Чтобы не нагружать API, полученные задачи (ключ, заголовок, описание) сохраняются в локальный файл `issues.json`. Данные в кэше считаются актуальными в течение одного часа. Если с момента последнего обновления прошло меньше часа, скрипт будет использовать кэш, а не делать новый запрос.
3.  **Ввод пользователя**: Скрипт запускается в интерактивном режиме и запрашивает у пользователя заголовок и (опционально) описание новой задачи.
4.  **Предобработка текста**: Введенные данные, а также заголовки и описания задач из трекера, проходят очистку: удаляются URL-адреса, HTML-теги, спецсимволы, и текст приводится к нижнему регистру.
5.  **Поиск схожести**:
    *   Скрипт поочередно сравнивает введенные данные с заголовками (`summary`) и описаниями (`description`) всех загруженных задач.
    *   Для каждого сравнения (заголовок с заголовками, описание с описаниями) вычисляется векторное представление текстов с помощью **TF-IDF**.
    *   Степень схожести определяется через **косинусное сходство** между векторами.
6.  **Вывод результата**: Скрипт выводит в консоль 5 наиболее похожих задач, отсортированных по убыванию процента схожести. Для каждой найденной задачи указывается её ключ, название, процент схожести и поле, в котором было найдено совпадение (заголовок или описание).

## Структура проекта

*   `main.py`: Главный файл для запуска скрипта в консоли. Логика вынесена в функции для возможности импорта.
*   `telegram_bot.py`: Модуль для запуска и работы Telegram-бота.
*   `yandex_tracker.py`: Модуль для взаимодействия с Yandex Tracker API, включая получение и кэширование задач.
*   `text_processor.py`: Модуль, содержащий функцию для очистки и предобработки текста.
*   `similarity_checker.py`: Модуль, реализующий основную логику поиска схожих задач с использованием TF-IDF и косинусного сходства.
*   `test_bot.py`: Юнит-тесты для проверки корректности работы логики.
*   `requirements.txt`: Файл с перечнем необходимых для работы Python-библиотек.
*   `.env`: Файл конфигурации для хранения учетных данных (токен, ID организации). **Не должен** попадать в систему контроля версий.
*   `issues.json`: Файл кэша, в котором хранятся загруженные из Yandex Tracker задачи.

## Установка и запуск

1.  **Клонируйте репозиторий**:
    ```bash
    git clone <URL-репозитория>
    cd <папка-проекта>
    ```

2.  **Создайте и активируйте виртуальное окружение**:
    ```powershell
    python -m venv venv
    .\venv\Scripts\Activate.ps1
    ```

3.  **Установите зависимости**:
    ```powershell
    pip install -r requirements.txt
    ```

4.  **Настройте `.env` файл**:
    Создайте файл `.env` в корне проекта и добавьте в него следующие переменные:
    ```
    YANDEX_TOKEN=ваш_токен_доступа
    YANDEX_ORG_ID=ваш_id_организации
    TG_BOT_APIKEY=ваш_ключ_api_телеграм_бота
    ```

5.  **Запуск**

    Вы можете запустить проект в одном из двух режимов:

    *   **Консольный скрипт**:
        ```powershell
        py main.py
        ```
        После запуска скрипт загрузит данные и предложит ввести заголовок новой задачи для проверки.

    *   **Телеграм-бот**:
        ```powershell
        py telegram_bot.py
        ```
        Бот запустится и будет готов принимать сообщения. Просто отправьте ему текст новой задачи.

6.  **Тестирование**

    Для проверки корректности работы можно запустить тесты:
    ```powershell
    py -m unittest test_bot.py
    ```